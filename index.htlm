<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily NCAAB Games & Bets</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Today's NCAA Men's D1 Basketball Games (as of February 20, 2026)</h1>
    <table id="gamesTable">
        <thead>
            <tr>
                <th>Game</th>
                <th>Time (EST)</th>
                <th>Spread</th>
                <th>Moneyline</th>
                <th>Total</th>
                <th>Analysis & Suggested Bet</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const ODDS_API_KEY = https://api.the-odds-api.com/v4/sports/basketball_ncaab/odds?apiKey=6d1bcc259c18af0e604ec5d7eb84c12e; // Replace with your key
        const today = new Date().toISOString().split('T')[0]; // Current date in YYYY-MM-DD

        async function fetchData(url) {
            const response = await fetch(url);
            return await response.json();
        }

        async function getGamesAndData() {
            const tableBody = document.querySelector('#gamesTable tbody');

            // Step 1: Fetch daily games from ESPN (schedules, teams, times)
            const espnScoreboard = await fetchData('https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/scoreboard?dates=' + today.replace(/-/g, ''));

            // Step 2: Fetch betting odds from The Odds API (one request for all games)
            const oddsData = await fetchData(`https://api.the-odds-api.com/v4/sports/basketball_ncaab/odds?apiKey=${ODDS_API_KEY}&regions=us&markets=h2h,spreads,totals&oddsFormat=american&dateFormat=iso`);

            const events = espnScoreboard.events || [];

            for (const event of events) {
                const homeTeam = event.competitions[0].competitors.find(c => c.homeAway === 'home');
                const awayTeam = event.competitions[0].competitors.find(c => c.homeAway === 'away');
                const gameTime = new Date(event.date).toLocaleTimeString('en-US', { timeZone: 'America/New_York', hour: 'numeric', minute: 'numeric' });
                const homeName = homeTeam.team.displayName;
                const awayName = awayTeam.team.displayName;

                // Match to odds by team names (normalize for matching)
                const matchingOdds = oddsData.find(o => 
                    (o.home_team.includes(homeName) || homeName.includes(o.home_team)) &&
                    (o.away_team.includes(awayName) || awayName.includes(o.away_team))
                );

                let spread = 'N/A', ml = 'N/A', total = 'N/A';
                if (matchingOdds) {
                    const avgBook = matchingOdds.bookmakers[0]; // Use first bookmaker (e.g., DraftKings) for simplicity
                    spread = avgBook.markets.find(m => m.key === 'spreads')?.outcomes.map(o => `${o.name} ${o.point} (${o.price})`).join(' vs ') || 'N/A';
                    ml = avgBook.markets.find(m => m.key === 'h2h')?.outcomes.map(o => `${o.name} (${o.price})`).join(' vs ') || 'N/A';
                    total = avgBook.markets.find(m => m.key === 'totals')?.outcomes.map(o => `${o.name} ${o.point} (${o.price})`).join(' vs ') || 'N/A';
                }

                // Step 3: Fetch team stats and records from ESPN
                const homeTeamData = await fetchData(`https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${homeTeam.team.id}`);
                const awayTeamData = await fetchData(`https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${awayTeam.team.id}`);
                const homeRecord = homeTeamData.team.record.items[0].summary;
                const awayRecord = awayTeamData.team.record.items[0].summary;
                const homeRank = homeTeamData.team.rank || 'Unranked';
                const awayRank = awayTeamData.team.rank || 'Unranked';

                // Fetch additional stats from NCAA API (e.g., points per game)
                const ncaaStats = await fetchData('https://ncaa-api.henrygd.me/stats/basketball-men/d1/current/team');
                const homeStats = ncaaStats.teams.find(t => t.name.includes(homeName)) || { ppg: 'N/A', oppg: 'N/A' };
                const awayStats = ncaaStats.teams.find(t => t.name.includes(awayName)) || { ppg: 'N/A', oppg: 'N/A' };

                // Step 4: Fetch injuries from rosters
                const homeRoster = await fetchData(`https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${homeTeam.team.id}/roster`);
                const awayRoster = await fetchData(`https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/teams/${awayTeam.team.id}/roster`);
                const homeInjuries = homeRoster.entries.filter(p => p.status && p.status.type !== 'healthy').length;
                const awayInjuries = awayRoster.entries.filter(p => p.status && p.status.type !== 'healthy').length;

                // Step 5: Simple analysis (heuristic: compare records, stats, injuries)
                let analysis = `Home: ${homeName} (${homeRecord}, Rank: ${homeRank}, PPG: ${homeStats.ppg || 'N/A'}, Injuries: ${homeInjuries}). Away: ${awayName} (${awayRecord}, Rank: ${awayRank}, PPG: ${awayStats.ppg || 'N/A'}, Injuries: ${awayInjuries}). `;
                let suggestedBet = 'No clear edge.';
                if (parseInt(homeRank) < parseInt(awayRank) && homeInjuries < awayInjuries && homeStats.ppg > awayStats.ppg) {
                    suggestedBet = 'Good bet: Home spread or ML (stronger team, fewer injuries).';
                } else if (parseInt(awayRank) < parseInt(homeRank) && awayInjuries < homeInjuries && awayStats.ppg > homeStats.ppg) {
                    suggestedBet = 'Good bet: Away spread or ML (underdog value).';
                } else if (homeStats.oppg + awayStats.oppg < 140) { // Arbitrary low-scoring threshold
                    suggestedBet = 'Good bet: Under total (defensive matchup).';
                }

                analysis += suggestedBet;

                // Display in table
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${awayName} @ ${homeName}</td>
                    <td>${gameTime}</td>
                    <td>${spread}</td>
                    <td>${ml}</td>
                    <td>${total}</td>
                    <td>${analysis}</td>
                `;
                tableBody.appendChild(row);
            }
        }

        getGamesAndData().catch(error => console.error('Error loading data:', error));
    </script>
</body>
</html>
